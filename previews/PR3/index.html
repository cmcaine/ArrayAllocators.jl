<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · ArrayAllocators.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://mkitti.github.io/ArrayAllocators.jl/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><script src="../copy.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>ArrayAllocators.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Example-Basic-Usage"><span>Example Basic Usage</span></a></li><li><a class="tocitem" href="#Caveats"><span>Caveats</span></a></li><li><a class="tocitem" href="#Interface-Details"><span>Interface Details</span></a></li></ul></li><li><a class="tocitem" href="bytecalculators/">Byte Calculators</a></li><li><a class="tocitem" href="numa/">NUMA</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mkitti/ArrayAllocators.jl/blob/master/docs/src/index.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="ArrayAllocators"><a class="docs-heading-anchor" href="#ArrayAllocators">ArrayAllocators</a><a id="ArrayAllocators-1"></a><a class="docs-heading-anchor-permalink" href="#ArrayAllocators" title="Permalink"></a></h1><p>Documentation for <a href="https://github.com/mkitti/ArrayAllocators.jl">ArrayAllocators</a>.</p><p>This Julia package provides mechanisms to allocate arrays beyond that provided in the <code>Base</code> module of Julia.</p><p>The instances of the sub types of <code>AbstractArrayAllocators</code> take the place of <code>undef</code> in the <code>Array{T}(undef, dims)</code> invocation. This allows us to take advantage of alternative ways of allocating memory. The allocators take advantage of <code>Base.unsafe_wrap</code> in order to create arrays from pointers. A finalizer is also added for allocators that do not use <code>Libc.free</code>.</p><p>The original inspiration for this package is the memory allocator <a href="https://en.cppreference.com/w/c/memory/calloc"><code>calloc</code></a>. <code>calloc</code> allocates the memory and guarantees that the memory will be initialized by zeros. By this definition, it would appear equivalent to <code>Base.zeros</code>. However, <code>calloc</code> is potentially able to take advantage of operating system facilities that allocate memory lazily on demand rather than eagerly. Additionally, it may be able to obtain memory from the operating system that has already been initialized by zeros due to security constraints. On many systems, this allocator returns as quickly as <code>malloc</code>, the allocator used by <code>Array{T}(undef, dims)</code>. In particular, in Python, <a href="https://github.com/juliantaylor/numpy/commit/d271d977bdfb977959db1ff26956666f3836b56b"><code>numpy.zeros</code></a> uses <code>calloc</code>, which may at times appear faster than <code>Base.zeros</code> in Julia.</p><p>In contrast, <code>Base.zeros</code> allocates memory using <code>malloc</code> and then uses <code>fill!</code> to eagerly and explicitly fill the array with zeros. On some systems, this may be a redudnant operation since the operating system may already know the allocated memory is filled with zeros.</p><p>This package makes <code>calloc</code> and other allocators available. Some of these allocators are specific to particular kinds of systems.</p><p>One example is allocating on Non-Uniform Memory Access (NUMA) nodes. On a NUMA system, random-access memory (RAM) may be accessible by certain processor cores at lower latency and higher bandwidth than other cores. Thus, it makes sense to allocate memory on particular NUMA nodes. On Linux, this is facilitated by <a href="https://github.com/numactl/numactl"><code>numactl</code></a> software which includes <code>libnuma</code>. On Windows, NUMA-aware memory allocation is exposed via the Kernel32 memory application programming interface such as via the function <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualallocexnuma`"><code>VirtualAllocExNuma</code></a>. This package provides an abstraction over the two libraries.</p><p>Another application is memory alignment which may facilitate the use of advanced vector instructions in modern processors.</p><p>One other feature of this package is implementation of &quot;Safe&quot; allocators. These allocators provide extra protection by detecting integer overflow situations. Integer overflow can occur when multiplying large numbers causing the result to potentially wrap around. Memory allocators may report success after allocating an wrapped around number of bytes. The &quot;Safe&quot; allocators use the <a href="https://github.com/JeffreySarnoff/SaferIntegers.jl"><code>SaferIntegers</code></a> to detect integer overflow avoiding this erroneous situation.</p><h2 id="Example-Basic-Usage"><a class="docs-heading-anchor" href="#Example-Basic-Usage">Example Basic Usage</a><a id="Example-Basic-Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Example-Basic-Usage" title="Permalink"></a></h2><p>Each of the methods below allocate 1 MiB of memory. Using <code>undef</code> as the first argument allocate uninitialized memory. The values are not guaranteed to be <code>0</code> or any other value.</p><p>In <code>Base</code>, the method <code>zeros</code> can be used to explicitly fill the memory with zeros. This is equivalent to using <code>fill!(..., 0)</code>. Using <code>calloc</code> guarantees the values will be <code>0</code>, yet is often as fast as using <code>undef</code> initialization.</p><pre><code class="language-julia hljs">julia&gt; using ArrayAllocators

julia&gt; @time U = Array{Int8}(undef, 1024, 1024);
  0.000019 seconds (2 allocations: 1.000 MiB)

julia&gt; @time Z1 = zeros(Int8, 1024, 1024);
  0.000327 seconds (2 allocations: 1.000 MiB)

julia&gt; @time Z2 = fill!(Array{UInt8}(undef, 1024, 1024), 0);
  0.000301 seconds (2 allocations: 1.000 MiB)

julia&gt; @time C = Array{Int8}(calloc, 1024, 1024);
  0.000020 seconds (4 allocations: 1.000 MiB)

julia&gt; sum(C)
0</code></pre><h2 id="Caveats"><a class="docs-heading-anchor" href="#Caveats">Caveats</a><a id="Caveats-1"></a><a class="docs-heading-anchor-permalink" href="#Caveats" title="Permalink"></a></h2><p>Above <code>calloc</code> appears to be much faster than <code>zeros</code> at generating an array full of <code>0</code>s. However, some of the array created with <code>zeros</code> has already been fully allocated. The array allocated with <code>calloc</code> take longer to initialize since the operating system may have deferred the actual allocation of memory.</p><pre><code class="language-julia hljs">julia&gt; @time Z = zeros(Int8, 1024, 1024);
  0.000324 seconds (2 allocations: 1.000 MiB)

julia&gt; @time fill!(Z, 1);
  0.000138 seconds

julia&gt; @time fill!(Z, 2);
  0.000136 seconds

julia&gt; @time U = Array{Int8}(calloc, 1024, 1024);
  0.000020 seconds (4 allocations: 1.000 MiB)

julia&gt; @time fill!(U, 1);
  0.000349 seconds

julia&gt; @time fill!(U, 2);
  0.000136 seconds</code></pre><h2 id="Interface-Details"><a class="docs-heading-anchor" href="#Interface-Details">Interface Details</a><a id="Interface-Details-1"></a><a class="docs-heading-anchor-permalink" href="#Interface-Details" title="Permalink"></a></h2><ul><li><a href="#ArrayAllocators.calloc"><code>ArrayAllocators.calloc</code></a></li><li><a href="#ArrayAllocators.malloc"><code>ArrayAllocators.malloc</code></a></li><li><a href="#ArrayAllocators.AbstractArrayAllocator"><code>ArrayAllocators.AbstractArrayAllocator</code></a></li><li><a href="bytecalculators/#ArrayAllocators.ByteCalculators.AbstractByteCalculator"><code>ArrayAllocators.ByteCalculators.AbstractByteCalculator</code></a></li><li><a href="bytecalculators/#ArrayAllocators.ByteCalculators.CheckedMulByteCalculator"><code>ArrayAllocators.ByteCalculators.CheckedMulByteCalculator</code></a></li><li><a href="bytecalculators/#ArrayAllocators.ByteCalculators.UnsafeByteCalculator"><code>ArrayAllocators.ByteCalculators.UnsafeByteCalculator</code></a></li><li><a href="bytecalculators/#ArrayAllocators.ByteCalculators.WideningByteCalculator"><code>ArrayAllocators.ByteCalculators.WideningByteCalculator</code></a></li><li><a href="#ArrayAllocators.CallocAllocator"><code>ArrayAllocators.CallocAllocator</code></a></li><li><a href="#ArrayAllocators.MallocAllocator"><code>ArrayAllocators.MallocAllocator</code></a></li><li><a href="#ArrayAllocators.MemAlign"><code>ArrayAllocators.MemAlign</code></a></li><li><a href="#ArrayAllocators.UndefArrayAllocator"><code>ArrayAllocators.UndefArrayAllocator</code></a></li><li><a href="numa/#NumaArrayAllocators.NumaAllocator"><code>NumaArrayAllocators.NumaAllocator</code></a></li><li><a href="bytecalculators/#SafeByteCalculators.SafeByteCalculator"><code>SafeByteCalculators.SafeByteCalculator</code></a></li><li><a href="#ArrayAllocators.wrap_libc_pointer-Union{Tuple{A}, Tuple{T}, Tuple{Type{A}, Ptr{T}, Any}} where {T, A&lt;:(AbstractArray{T})}"><code>ArrayAllocators.wrap_libc_pointer</code></a></li><li><a href="numa/#NumaArrayAllocators.numa"><code>NumaArrayAllocators.numa</code></a></li></ul><article class="docstring"><header><a class="docstring-binding" id="ArrayAllocators.calloc" href="#ArrayAllocators.calloc"><code>ArrayAllocators.calloc</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">calloc</code></pre><p>CallocAllocator singleton.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; A = Array{UInt8}(calloc, 16, 16);

julia&gt; sum(A)
0x0000000000000000</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ArrayAllocators.jl/blob/217b657d73847971e1defaa632f95f4578276866/src/ArrayAllocators.jl#L115-L128">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ArrayAllocators.malloc" href="#ArrayAllocators.malloc"><code>ArrayAllocators.malloc</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">malloc</code></pre><p>MallocAllocator singleton.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; Array{UInt8}(malloc, 16, 16);
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ArrayAllocators.jl/blob/217b657d73847971e1defaa632f95f4578276866/src/ArrayAllocators.jl#L86-L98">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ArrayAllocators.AbstractArrayAllocator" href="#ArrayAllocators.AbstractArrayAllocator"><code>ArrayAllocators.AbstractArrayAllocator</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractArrayAllocator{B}</code></pre><p>Parent abstract type for array allocators. Parameter <code>B</code> is an AbstractByteCalculator Defines <code>Array{T}(allocator, dims...) where T = Array{T}(allocator, dims)</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ArrayAllocators.jl/blob/217b657d73847971e1defaa632f95f4578276866/src/ArrayAllocators.jl#L18-L23">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ArrayAllocators.CallocAllocator" href="#ArrayAllocators.CallocAllocator"><code>ArrayAllocators.CallocAllocator</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">CallocAllocator()</code></pre><p>Use Libc.calloc to allocate an array. This is similar to <code>zeros</code>, except that the Libc implementation or the operating system may allocate and zero the memory in a lazy fashion.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ArrayAllocators.jl/blob/217b657d73847971e1defaa632f95f4578276866/src/ArrayAllocators.jl#L101-L107">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ArrayAllocators.MallocAllocator" href="#ArrayAllocators.MallocAllocator"><code>ArrayAllocators.MallocAllocator</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">MallocAllocator()</code></pre><p>Allocate array using <code>Libc.malloc</code>. This is not meant to be useful but rather just to prototype the concept for a custom array allocator concept. This should be similar to using <code>undef</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ArrayAllocators.jl/blob/217b657d73847971e1defaa632f95f4578276866/src/ArrayAllocators.jl#L73-L79">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ArrayAllocators.MemAlign" href="#ArrayAllocators.MemAlign"><code>ArrayAllocators.MemAlign</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">MemAlign(alignment::Integer)</code></pre><p>Allocate aligned memory. Alias for platform specific implementations.</p><p><code>alignment</code> must be a power of 2 and larger than <code>sizeof(Int)</code></p><p>POSIX (Linux and macOS): <a href="@ref"><code>PosixMemAlign</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ArrayAllocators.jl/blob/217b657d73847971e1defaa632f95f4578276866/src/ArrayAllocators.jl#L131-L139">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ArrayAllocators.UndefArrayAllocator" href="#ArrayAllocators.UndefArrayAllocator"><code>ArrayAllocators.UndefArrayAllocator</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">UndefArrayAllocator{B}</code></pre><p>Allocate arrays using the builtin <code>undef</code> method. The <code>B</code> parameter is a <code>ByteCalculator</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ArrayAllocators.jl/blob/217b657d73847971e1defaa632f95f4578276866/src/ArrayAllocators.jl#L42-L46">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ArrayAllocators.wrap_libc_pointer-Union{Tuple{A}, Tuple{T}, Tuple{Type{A}, Ptr{T}, Any}} where {T, A&lt;:(AbstractArray{T})}" href="#ArrayAllocators.wrap_libc_pointer-Union{Tuple{A}, Tuple{T}, Tuple{Type{A}, Ptr{T}, Any}} where {T, A&lt;:(AbstractArray{T})}"><code>ArrayAllocators.wrap_libc_pointer</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">wrap_libc_pointer(::Type{A}, ptr::Ptr{T}, dims) where {T, A &lt;: AbstractArray{T}}
wrap_libc_pointer(ptr::Ptr{T}, dims) where {T, A &lt;: AbstractArray{T}}</code></pre><p>Checks to see if <code>ptr</code> is C_NULL for an OutOfMemoryError. Owns the array such that <code>Libc.free</code> is used.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ArrayAllocators.jl/blob/217b657d73847971e1defaa632f95f4578276866/src/ArrayAllocators.jl#L55-L61">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="bytecalculators/">Byte Calculators »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.12 on <span class="colophon-date" title="Wednesday 20 April 2022 17:11">Wednesday 20 April 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
